id: org.arx_libertatis.ArxLibertatis
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: arx
rename-desktop-file: arx-libertatis.desktop
rename-icon: arx-libertatis
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --socket=pulseaudio
  # We can import game data from Steam on the host
  - --filesystem=xdg-data/Steam/steamapps:ro
modules:
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=${FLATPAK_DEST} --with-libraries=headers
      - ./b2 -j $FLATPAK_BUILDER_N_JOBS install --layout=system
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.81.0/source/boost_1_81_0.tar.bz2
        sha256: 71feeed900fbccca04a3b4f2f84a7c217186f28a940ed8b7ed4725986baf99fa
        x-checker-data:
          type: anitya
          project-id: 6845
          stable-only: true
          url-template: https://boostorg.jfrog.io/artifactory/main/release/$version/source/boost_${major}_${minor}_$patch.tar.bz2

  - name: glm
    buildsystem: simple
    build-commands:
      - cp -r glm ${FLATPAK_DEST}/include
    cleanup:
      - '*'
    sources:
      - type: archive
        url: https://github.com/g-truc/glm/archive/refs/tags/0.9.9.8.tar.gz
        sha256: 7d508ab72cb5d43227a3711420f06ff99b0a0cb63ee2f93631b162bfe1fe9592
        x-checker-data:
          type: json
          url: https://api.github.com/repos/g-truc/glm/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/g-truc/glm/archive/refs/tags/" + $version + ".tar.gz"'

  - shared-modules/SDL2/SDL2-2.26.1-with-libdecor.json

  - name: arx-libertatis
    buildsystem: cmake-ninja
    config-opts:
      - -DINSTALL_BLENDER_PLUGIN=OFF
      - -DUSE_WAYLAND=ON
    post-install:
      - install -Dm644 org.arx_libertatis.ArxLibertatis.metainfo.xml ${FLATPAK_DEST}/share/metainfo/org.arx_libertatis.ArxLibertatis.metainfo.xml
    sources:
      - type: archive
        url: https://github.com/arx/ArxLibertatis/releases/download/1.2.1/arx-libertatis-1.2.1.tar.xz
        sha256: aafd8831ee2d187d7647ad671a03aabd2df3b7248b0bac0b3ac36ffeb441aedf
        x-checker-data:
          type: json
          url: https://api.github.com/repos/arx/ArxLibertatis/releases/latest
          version-query: .tag_name
          url-query: '"https://github.com/arx/ArxLibertatis/releases/download/" + $version + "/arx-libertatis-" + $version + ".tar.xz"'
          is-main-source: true
      - type: file
        path: org.arx_libertatis.ArxLibertatis.metainfo.xml
